# ุงุณู ุงูู Workflow ุงูุฐู ุณูุธูุฑ ูู ุตูุญุฉ Actions ุนูู GitHub
name: 'ูุญุต ูุฅุตูุงุญ ุฌูุฏุฉ ุงููุงูุจ (WordPress)'

# ูุชู ูุชู ุชุดุบูู ูุฐุง ุงูุฃูุฑ
on:
  push:
    branches:
      - main

# ====> ูุฐุง ูู ุงูุฌุฒุก ุงูุฌุฏูุฏ ุงูุฐู ุชู ุฅุถุงูุชู <====
# ููุญ ุตูุงุญูุฉ ุงููุชุงุจุฉ ููู workflow ููุชููู ูู ุญูุธ ุงูุชุนุฏููุงุช
permissions:
  contents: write

# ุงูููุงู ุงูุชู ุณูุชู ุชูููุฐูุง
jobs:
  fix-code-style:
    name: 'ุงูุฅุตูุงุญ ุงูุชููุงุฆู ูุชูุณูู ุงูููุฏ'
    runs-on: ubuntu-latest
    steps:
      # ุงูุฎุทูุฉ 1: ุฌูุจ ูุณุฎุฉ ูู ููุฏ ุงููุงูุจ
      - name: 'Checkout code'
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      # ุงูุฎุทูุฉ 2: ุฅุนุฏุงุฏ ุจูุฆุฉ ุนูู PHP ูุน ุงูุฃุฏูุงุช ุงููุทููุจุฉ
      - name: 'Setup PHP'
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.0'
          tools: composer, phpcs

      # ุงูุฎุทูุฉ 3: ุชุซุจูุช ูุนุงููุฑ ููุฑุฏุจุฑูุณ ุนุจุฑ Composer
      - name: 'Install WordPress Coding Standards'
        run: |
          composer init --quiet --no-interaction --name="alam-al-anika/ci-tools"
          composer config --no-plugins allow-plugins.dealerdirect/phpcodesniffer-composer-installer true
          composer require --dev wp-coding-standards/wpcs dealerdirect/phpcodesniffer-composer-installer

      # ุงูุฎุทูุฉ 4: ุชุดุบูู ุฃุฏุงุฉ ุงูุฅุตูุงุญ ุงูุชููุงุฆู
      - name: 'Run Auto-Fixer (phpcbf)'
        run: |
          ./vendor/bin/phpcbf . --standard=WordPress --ignore=*/vendor/*,*/node_modules/*,*/assets/*

      # ุงูุฎุทูุฉ 5: ุญูุธ ุงูุชุนุฏููุงุช ุชููุงุฆููุง ูู ุงููุณุชูุฏุน
      - name: 'Commit changes'
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: '๐จ Chore: ุฅุตูุงุญ ุชููุงุฆู ูุชูุณูู ุงูููุฏ'
          commit_user_name: 'GitHub Actions Bot'
          commit_user_email: 'github-actions[bot]@users.noreply.github.com'
          commit_author: 'GitHub Actions Bot <github-actions[bot]@users.noreply.github.com>'
