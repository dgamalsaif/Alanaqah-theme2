 name: Check Existing Color Swatches Code

on:
  workflow_dispatch

jobs:
  check-existing-code:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: البحث عن أنماط Color Swatches في CSS
      run: |
        echo "🔍 البحث عن أنماط Color Swatches في ملفات CSS..."
        
        # البحث في جميع ملفات CSS
        CSS_FILES=$(find . -name "*.css" -not -path "./.github/*")
        
        for css_file in $CSS_FILES; do
            echo "📁 فحص ملف: $css_file"
            
            # البحث عن أنماط swatches
            if grep -q -i "color-swatch\|swatch\|color.*circle" "$css_file"; then
                echo "🎨 found color swatch styles in: $css_file"
                grep -n -i "color-swatch\|swatch\|color.*circle" "$css_file" | head -5
                echo "---"
            fi
            
            # البحث عن ألوان محددة
            if grep -q -i "#ff2b4d\|#e0e0e0\|#f5a623" "$css_file"; then
                echo "🎯 found specific colors in: $css_file"
                grep -n -i "#ff2b4d\|#e0e0e0\|#f5a623" "$css_file" | head -3
                echo "---"
            fi
        done
        
        if [ -z "$CSS_FILES" ]; then
            echo "⚪ لم يتم العثور على أي ملفات CSS"
        fi

    - name: البحث عن كود Color Swatches في JavaScript
      run: |
        echo "🔍 البحث عن كود Color Swatches في ملفات JS..."
        
        # البحث في جميع ملفات JavaScript
        JS_FILES=$(find . -name "*.js" -not -path "./.github/*" -not -path "./assets/js/vendor/*")
        
        for js_file in $JS_FILES; do
            echo "📁 فحص ملف: $js_file"
            
            # البحث عن كود swatches
            if grep -q -i "swatch\|color.*click\|attribute.*select" "$js_file"; then
                echo "⚡ found swatch-related code in: $js_file"
                grep -n -i "swatch\|color.*click\|attribute.*select" "$js_file" | head -5
                echo "---"
            fi
            
            # البحث عن أحداث variation
            if grep -q -i "variation\|woocommerce.*change" "$js_file"; then
                echo "🛒 found variation code in: $js_file"
                grep -n -i "variation\|woocommerce.*change" "$js_file" | head -3
                echo "---"
            fi
        done
        
        if [ -z "$JS_FILES" ]; then
            echo "⚪ لم يتم العثور على أي ملفات JS"
        fi

    - name: التحقق من وجود مجلد add-to-cart
      run: |
        echo "📁 التحقق من هيكل woocommerce..."
        
        if [ -d "woocommerce/single-product/add-to-cart" ]; then
            echo "✅ مجلد add-to-cart موجود"
            find "woocommerce/single-product/add-to-cart" -name "*.php" | while read file; do
                echo "📄 ملف موجود: $file"
                if grep -q -i "variation\|color\|swatch" "$file"; then
                    echo "🎨 found swatch-related code in: $file"
                    grep -n -i "variation\|color\|swatch" "$file" | head -3
                fi
            done
        else
            echo "⚪ مجلد add-to-cart غير موجود"
            echo "📋 الهيكل الحالي لـ woocommerce:"
            find "woocommerce" -type f -name "*.php" | head -10
        fi

    - name: تقرير النتائج
      run: |
        echo "📊 تقرير التحقق من Color Swatches:"
        echo "=========================================="
        echo "✅ تم فحص جميع ملفات CSS و JS ذات الصلة"
        echo "🔍 البحث عن أنماط: color-swatch, swatch, variation"
        echo "📁 تم فحص هيكل مجلدات woocommerce"
        echo "=========================================="
        echo "📋 الخطوات التالية بناء على النتائج:"
        echo "1. إذا وجدت الأكواد: سيتم تحسينها وتطويرها"
        echo "2. إذا لم توجد: سيتم إضافتها بشكل صحيح"
        echo "3. سيكون التركيز على الدمج مع الكود الحالي"
