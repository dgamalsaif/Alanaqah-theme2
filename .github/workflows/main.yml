name: Comprehensive Theme Validation

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  comprehensive-theme-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: ุชุญููู ุงูููุฏ ูู ุงููุณุชูุฏุน
      uses: actions/checkout@v3

    - name: ุงูุชุญูู ูู ุงููููู ุงูุฃุณุงุณู
      run: |
        echo "๐ ุงูุชุญูู ูู ูููู ุงููุงูุจ ุงููุชูุงูู..."
        
        # ุงููููุงุช ุงูุฃุณุงุณูุฉ ุงูุฅูุฒุงููุฉ
        REQUIRED_FILES=("style.css" "index.php" "functions.php")
        for file in "${REQUIRED_FILES[@]}"; do
          if [ ! -f "$file" ]; then
            echo "โ ููู ุฅูุฒุงูู ุบูุฑ ููุฌูุฏ: $file"
            exit 1
          fi
          echo "โ ููุฌูุฏ: $file"
        done

    - name: ุฅุนุฏุงุฏ Node.js ูููุญุต
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'

    - name: ูุญุต ุดุงูู ููููุงุช JavaScript
      run: |
        echo "๐ ูุญุต ูููุงุช JavaScript ูุงูููุชุจุงุช..."
        
        # ุงูุจุญุซ ุนู ุฌููุน ูููุงุช JavaScript
        JS_FILES=$(find . -name "*.js" -not -path "./node_modules/*" -not -path "./.github/*")
        
        if [ -z "$JS_FILES" ]; then
          echo "โช ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃู ูููุงุช JavaScript"
          exit 0
        fi
        
        echo "๐ ุนุฏุฏ ูููุงุช JavaScript ุงูููุฌูุฏุฉ: $(echo "$JS_FILES" | wc -l)"
        
        # ูุญุต ูุฌูุฏ ุงูููุชุจุงุช ุงูุดุงุฆุนุฉ
        echo "๐ ุงูุจุญุซ ุนู ุงูููุชุจุงุช ุงูุดุงุฆุนุฉ:"
        
        LIBRARIES=("jquery" "react" "vue" "axios" "lodash" "bootstrap" "swiper" "gsap")
        for lib in "${LIBRARIES[@]}"; do
          if grep -r -i "$lib" . --include="*.js" --include="*.php" --exclude-dir=node_modules --exclude-dir=.git > /dev/null; then
            echo "โ ููุฌูุฏุฉ: $lib"
          else
            echo "โช ุบูุฑ ููุฌูุฏุฉ: $lib"
          fi
        done

    - name: ูุญุต ุฌูุฏุฉ JavaScript
      run: |
        echo "๐๏ธ ูุญุต ุฌูุฏุฉ ููุฏ JavaScript..."
        
        # ุฅูุดุงุก package.json ูุคูุช ุฅุฐุง ูู ููู ููุฌูุฏุงู
        if [ ! -f "package.json" ]; then
          echo '{"name":"temp-check","version":"1.0.0"}' > package.json
        fi
        
        # ุชุซุจูุช ESLint ูููุญุต ุฅุฐุง ูุฒู ุงูุฃูุฑ
        npm install eslint --no-save --no-package-lock
        
        # ูุญุต ุงููููุงุช ุจุงุณุชุฎุฏุงู ESLint
        JS_FILES=$(find . -name "*.js" -not -path "./node_modules/*" -not -path "./.github/*")
        for js_file in $JS_FILES; do
          echo "๐ ูุญุต ููู: $js_file"
          npx eslint --no-eslintrc --env browser "$js_file" --format compact || true
        done

    - name: ูุญุต ุงูุชุจุนูุงุช ูุงูููุชุจุงุช
      run: |
        echo "๐ฆ ูุญุต ุชุจุนูุงุช JavaScript..."
        
        # ุงูุจุญุซ ุนู ููุชุจุงุช ูุถููุฉ ุนุจุฑ CDN
        echo "๐ ุงูููุชุจุงุช ุงููุถููุฉ ุนุจุฑ CDN:"
        grep -r -i "cdn\.\|cloudflare\.\|unpkg\.\|stackpath\.bootstrapcdn" . --include="*.php" --include="*.js" --include="*.html" || echo "โช ูุง ุชูุฌุฏ ููุชุจุงุช CDN"
        
        # ุงูุจุญุซ ุนู ุงุณุชุฏุนุงุกุงุช ููุชุจุงุช ุฎุงุฑุฌูุฉ
        echo "๐ก ุงูุงุณุชุฏุนุงุกุงุช ุงูุฎุงุฑุฌูุฉ:"
        grep -r -E "(http|https)://.*\.js" . --include="*.php" --include="*.js" --include="*.html" | head -10 || echo "โช ูุง ุชูุฌุฏ ุงุณุชุฏุนุงุกุงุช ุฎุงุฑุฌูุฉ"

    - name: ูุญุต ุฃุฏุงุก JavaScript
      run: |
        echo "โก ูุญุต ุฃุฏุงุก JavaScript..."
        
        # ุงูุชุญูู ูู ุญุฌู ูููุงุช JavaScript
        JS_FILES=$(find . -name "*.js" -not -path "./node_modules/*" -not -path "./.github/*")
        for js_file in $JS_FILES; do
          size=$(wc -c < "$js_file")
          if [ "$size" -gt 1000000 ]; then
            echo "โ๏ธ  ููู ูุจูุฑ: $js_file ($((size/1000)) KB)"
          else
            echo "โ ุญุฌู ููุงุณุจ: $js_file ($((size/1000)) KB)"
          fi
        done

    - name: ูุญุต ุงูุฃูุงู
      run: |
        echo "๐ ูุญุต ุฃูุงู JavaScript..."
        
        # ุงูุจุญุซ ุนู ุฃููุงุท ูุฏ ุชููู ุฎุทูุฑุฉ
        PATTERNS=("eval(" "innerHTML" "document\.write" "setTimeout(" "setInterval(")
        for pattern in "${PATTERNS[@]}"; do
          echo "๐ ุงูุจุญุซ ุนู: $pattern"
          grep -r -n "$pattern" . --include="*.js" --exclude-dir=node_modules --exclude-dir=.git | head -5 || echo "โช ูุง ุชูุฌุฏ ูุชุงุฆุฌ"
        done

    - name: ุฅูุดุงุก ุชูุฑูุฑ ุดุงูู
      run: |
        echo "๐ ุชูุฑูุฑ JavaScript ุงูุดุงูู:"
        echo "=========================================="
        
        JS_COUNT=$(find . -name "*.js" -not -path "./node_modules/*" -not -path "./.github/*" | wc -l)
        echo "๐ ุนุฏุฏ ูููุงุช JavaScript: $JS_COUNT"
        
        PHP_JS_REFS=$(grep -r -l "wp_enqueue_script\|wp_register_script" . --include="*.php" | wc -l)
        echo "๐ ุนุฏุฏ ูููุงุช PHP ุงูุชู ุชุณุฌู scripts: $PHP_JS_REFS"
        
        echo "=========================================="
        echo "โ ุชู ุงูุงูุชูุงุก ูู ุงููุญุต ุงูุดุงูู ูู JavaScript"

    - name: ูุญุต ููููุงุช ุงููุงูุจ ุงููุชูุฏูุฉ
      run: |
        echo "๐ ุงูุจุญุซ ุนู ููููุงุช ูุชูุฏูุฉ (Slider, Hero, etc)..."
        
        # ุงูุจุญุซ ุนู ูููุงุช ูุฏ ุชุญุชูู ุนูู Slider
        SLIDER_FILES=$(grep -l -i "slider\|carousel" *.php template-parts/*.php 2>/dev/null || true)
        if [ -n "$SLIDER_FILES" ]; then
          echo "๐ ูููุงุช ุชุญุชูู ุนูู Slider:"
          echo "$SLIDER_FILES"
        else
          echo "โช ูู ูุชู ุงูุนุซูุฑ ุนูู ูููู Slider"
        fi

    - name: ูุญุต ุดุงูู ููุฃููุงู ูุงูุชุตููู
      run: |
        echo "๐จ ูุญุต ูุธุงู ุงูุฃููุงู ูุงูุชุตููู..."
        
        CSS_FILES=$(find . -name "*.css" -not -path "./.github/*")
        if [ -n "$CSS_FILES" ]; then
          echo "๐ ุชูุฑูุฑ ุงูุฃููุงู ุงููุณุชุฎุฏูุฉ:"
          grep -E -i "(#([0-9A-Fa-f]{6}|[0-9A-Fa-f]{3})|rgb\(|rgba\(|hsl\()" $(echo "$CSS_FILES") | \
          sort | uniq | head -15
        else
          echo "โช ูุง ุชูุฌุฏ ูููุงุช CSS ูููุญุต"
        fi

    - name: ุชูุฑูุฑ ููุงุฆู
      run: |
        echo "๐ ุชู ุงูุงูุชูุงุก ูู ุงููุญุต ุงูุดุงูู!"
        echo "๐ ุงููุชุงุฆุฌ ุชุดูู:"
        echo "   - โ ูููู ุงููุงูุจ ุงูุฃุณุงุณู"
        echo "   - ๐ ูููุงุช JavaScript ูุงูููุชุจุงุช"
        echo "   - ๐๏ธ  ุฌูุฏุฉ ููุฏ JavaScript"
        echo "   - ๐ฆ ุงูุชุจุนูุงุช ูุงูููุชุจุงุช"
        echo "   - โก ุฃุฏุงุก JavaScript"
        echo "   - ๐ ุฃูุงู JavaScript"
        echo "   - ๐ ุงูููููุงุช ุงููุชูุฏูุฉ"
        echo "   - ๐จ ูุธุงู ุงูุฃููุงู"
