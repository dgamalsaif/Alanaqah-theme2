# اسم الـ Workflow الذي سيظهر في صفحة Actions على GitHub
name: 'فحص وإصلاح جودة القالب (WordPress)'

# متى يتم تشغيل هذا الأمر
on:
  push:
    branches:
      - main

# المهام التي سيتم تنفيذها
jobs:
  fix-code-style:
    name: 'الإصلاح التلقائي لتنسيق الكود'
    runs-on: ubuntu-latest
    steps:
      # الخطوة 1: جلب نسخة من كود القالب
      - name: 'Checkout code'
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      # الخطوة 2: إعداد بيئة عمل PHP مع الأدوات المطلوبة
      - name: 'Setup PHP'
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.0'
          tools: composer, phpcs

      # الخطوة 3: تثبيت معايير ووردبريس عبر Composer
      - name: 'Install WordPress Coding Standards'
        run: |
          composer init --quiet --no-interaction --name="alam-al-anika/ci-tools"
          composer config --no-plugins allow-plugins.dealerdirect/phpcodesniffer-composer-installer true
          composer require --dev wp-coding-standards/wpcs dealerdirect/phpcodesniffer-composer-installer

      # الخطوة 4: تشغيل أداة الإصلاح التلقائي
      - name: 'Run Auto-Fixer (phpcbf)'
        # ====> هذا هو التعديل الأخير <====
        # تجاهل كود الخروج الخاص بالأداة للسماح بإكمال الخطوات
        continue-on-error: true
        run: |
          ./vendor/bin/phpcbf . --standard=WordPress --ignore=*/vendor/*,*/node_modules/*,*/assets/js/*

      # الخطوة 5: حفظ التعديلات تلقائيًا في المستودع
      - name: 'Commit changes'
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: '🎨 Chore: إصلاح تلقائي لتنسيق الكود'
          commit_user_name: 'GitHub Actions Bot'
          commit_user_email: 'github-actions[bot]@users.noreply.github.com'
          commit_author: 'GitHub Actions Bot <github-actions[bot]@users.noreply.github.com>'
