# اسم الـ Workflow الذي سيظهر في صفحة Actions على GitHub
name: 'WordPress Theme Quality Check'

# متى يتم تشغيل هذا الأمر
on:
  push:
    branches:
      - main # يتم التشغيل عند أي تحديث لفرع main
  pull_request:
    branches:
      - main # يتم التشغيل عند أي طلب دمج لفرع main

# المهام التي سيتم تنفيذها
jobs:
  # المهمة الأولى: فحص القالب باستخدام أداة Theme Check الرسمية يدويًا
  theme-check:
    name: 'Official Theme Check'
    runs-on: ubuntu-latest

    steps:
      # الخطوة 1: جلب نسخة من كود القالب
      - name: 'Checkout Theme Code'
        uses: actions/checkout@v4

      # الخطوة 2: تنزيل وتثبيت أداة فحص القوالب الرسمية
      - name: 'Download and Install Theme Check Plugin'
        run: |
          wget -q https://downloads.wordpress.org/plugin/theme-check.zip
          unzip -q theme-check.zip
          rm theme-check.zip

      # الخطوة 3: تشغيل الفحص على مجلد القالب
      - name: 'Run Theme Check'
        run: |
          php -l ./theme-check/checkbase.php
          ./theme-check/checkbase.php -d . -t alam-al-anika
        continue-on-error: true

  # المهمة الثانية: فحص جودة الكود البرمجي (PHP)
  php-codesniffer:
    name: 'PHP Code Sniffer (WordPress Standards)'
    runs-on: ubuntu-latest

    steps:
      # الخطوة 1: جلب نسخة من كود القالب
      - name: 'Checkout code'
        uses: actions/checkout@v4

      # الخطوة 2: إعداد بيئة عمل PHP
      - name: 'Setup PHP'
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.0'
          tools: composer, phpcs

      # الخطوة 3: تثبيت معايير ووردبريس لأداة الفحص
      - name: 'Install WordPress Coding Standards'
        run: |
          # السطر التالي هو السطر المهم الذي تم تصحيحه
          git clone -b main https://github.com/WordPress/WordPress-Coding-Standards.git wpcs
          phpcs --config-set installed_paths "$(pwd)/wpcs"

      # الخطوة 4: تشغيل أداة فحص جودة الكود
      - name: 'Run PHP_CodeSniffer'
        run: |
          phpcs . --standard=WordPress --ignore=*/vendor/*,*/node_modules/*,*/assets/js/vendor/*
